{
  "name": "Apify Instagram Competitor Analyzer",
  "nodes": [
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "de61fa32-4af5-48ae-ad10-2555006ea044",
              "name": "username",
              "value": "={{ $json.body.usernames }}",
              "type": "array"
            },
            {
              "id": "418a40d1-ae47-4a09-9612-b4281e945e30",
              "name": "max_posts",
              "value": "={{ $json.body.max_posts }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3264,
        -144
      ],
      "id": "66e98f81-a058-4454-950f-667aa87bafac",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "ig-analyzer",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -3520,
        -144
      ],
      "id": "bc0d3e93-5f9b-4cd7-96c3-fef673f96946",
      "name": "Webhook",
      "webhookId": "a0db3a30-1969-47c0-8c87-a5cb6ba50cf7"
    },
    {
      "parameters": {
        "content": "## ðŸŽ¯ STEP 1: Instagram Competitor Scraping\n\nThis section loops over usernames & scrape profiles posts from competitor accounts using [Instgram Scraper All-In-One](https://apify.com/mido_99/Instgram-Scraper-All-in-One).\n\n**Key Setup:**\n- Add your target Instagram usernames to the JSON body\n(e.g.: `data = {'usernames': ['leomessi', 'cristiano']}`.\n- Adjust `max_posts` in JSON body (5 = latest 5 posts per account)\n- Replace Apify API in node *\"Run IG Scraper & Get dataset\"* with your actual API key.",
        "height": 312,
        "width": 510
      },
      "id": "0ff0d978-93e8-4a39-840f-aaaa948ba4e4",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3488,
        -496
      ],
      "typeVersion": 1,
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## ðŸ” STEP 2: Smart Duplicate Prevention\n\nThis section prevents processing the same content twice:\n\n*I credit this logic to [Nick Saraev](https://n8n.io/workflows/4658-automate-instagram-content-discovery-and-repurposing-w-apify-gpt-4o-and-perplexity/), I like his ideas BTWðŸ™‚*\n\n1. **Search for Entries**: Checks if post ID already exists in database\n2. **Drop Duplicates**: Removes already-processed content using merge logic\n3. **Add Entries**: Only adds genuinely new content to Google Sheets\n\n***Critical**: The merge node compares IDs and keeps only non-matches (new content)*",
        "height": 324,
        "width": 556
      },
      "id": "2d7701ed-3ed2-414b-9256-cc34c7e4bd28",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2416,
        -512
      ],
      "typeVersion": 1,
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## ðŸ§  STEP 3: AI-Powered Content Analysis\n\nThe AI pipeline processes each post as follows:\n\n1. **Analyze Images** Use Gemini to analyze images of single=image or album posts to extract persons, objects, theme, vibes, text on image (optional), ...\n2. **Analyze Video**: Analyze transcribed text (optional), visual hooks, emotional_tone, etc...\n3. **Analyze Text** Extract meaning and tone from caption & do sentiment analysis on comments.\n4. **Save Results to Google Sheet** Add both visual / textual analysis to rows based on post ID.\n",
        "height": 280,
        "width": 688
      },
      "id": "c248b874-f9de-4a7e-b968-97a2b26c77b3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1296,
        -960
      ],
      "typeVersion": 1,
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "mode": "combine",
        "fieldsToMatchString": "id",
        "joinMode": "keepNonMatches",
        "options": {}
      },
      "id": "96166f5e-3aae-4b87-9946-6237713d012d",
      "name": "Drop Duplicates",
      "type": "n8n-nodes-base.merge",
      "position": [
        -2432,
        -144
      ],
      "typeVersion": 3,
      "executeOnce": false
    },
    {
      "parameters": {
        "operation": "Run actor and get dataset",
        "actorId": {
          "__rl": true,
          "value": "iMjTYeesbFO1YaVYZ",
          "mode": "list",
          "cachedResultName": "Instgram Scraper All-In-One (mido_99/Instgram-Scraper-All-in-One)",
          "cachedResultUrl": "https://console.apify.com/actors/iMjTYeesbFO1YaVYZ/input"
        },
        "customBody": "={\n  \"usernames_keywords\": [\n    \"{{ $json.username }}\"\n  ],\n  \"maxResults\": {{ $json.max_posts }},\n  \"scrapeMode\": \"posts\"\n}",
        "timeout": {},
        "memory": 256
      },
      "type": "@apify/n8n-nodes-apify.apify",
      "typeVersion": 1,
      "position": [
        -2864,
        -144
      ],
      "id": "98028dfc-a416-4f58-b73a-49d7e894716c",
      "name": "Run IG Scraper & Get dataset",
      "credentials": {
        "apifyApi": {
          "id": "FU1FpC4TwjR5Ddvb",
          "name": "Apify - main account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1u0XML8wegNye1tDqOoYnTY0n1QeXQYTbeArMt1pUYaw",
          "mode": "list",
          "cachedResultName": "IG Analysis",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1u0XML8wegNye1tDqOoYnTY0n1QeXQYTbeArMt1pUYaw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1u0XML8wegNye1tDqOoYnTY0n1QeXQYTbeArMt1pUYaw/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $json.id }}",
            "shortCode": "={{ $json.shortCode }}",
            "created_at": "={{ $json.created_at }}",
            "caption": "={{ $json.caption }}",
            "url": "={{ $json.url }}",
            "likes": "={{ $json.likes_count }}",
            "comments_count": "={{ $json.comments_count }}",
            "display_image": "={{ $json.display_image }}",
            "acc_caption": "={{ $json.acc_caption }}",
            "is_sponsorship": "={{ $json.is_sponsorship }}",
            "username": "={{ $json.user.username }}",
            "coAuthors": "={{ $json.co_authors.map(co_author => co_author.username).join(', ') }}",
            "mentions": "={{ ($json.mentions || []).join(', ') }}",
            "tagged_users": "={{ $json.tagged_users.map(tagged => tagged.username).join(', ') }}",
            "images": "={{ $json.images }}",
            "type": "={{ $json.type }}",
            "video_url": "={{ $json.video_url }}",
            "comments": "={{ $json.comments.map(comment => comment.text).filter(text => text && text.trim().length >0).join('\\nâ€”\\n') }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "shortCode",
              "displayName": "shortCode",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "caption",
              "displayName": "caption",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "likes",
              "displayName": "likes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "comments_count",
              "displayName": "comments_count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "display_image",
              "displayName": "display_image",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "acc_caption",
              "displayName": "acc_caption",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "is_sponsorship",
              "displayName": "is_sponsorship",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "username",
              "displayName": "username",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "coAuthors",
              "displayName": "coAuthors",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "mentions",
              "displayName": "mentions",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "tagged_users",
              "displayName": "tagged_users",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "type",
              "displayName": "type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "images",
              "displayName": "images",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "video_url",
              "displayName": "video_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "comments",
              "displayName": "comments",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "cellFormat": "RAW",
          "useAppend": true
        }
      },
      "id": "977f4a09-56a3-46d1-8177-a16300ce0b5c",
      "name": "Save Posts",
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        -2016,
        -144
      ],
      "typeVersion": 4.5,
      "alwaysOutputData": false,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "ajZSh0M8tmSlUQzG",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "for item in items:\n  # Edit single item\n  if item.json.caption:\n    item.json.caption = item.json.caption[:2000]\n  # Edit lists\n  for comment in item.json.comments:\n    if comment.text:\n      comment.text = comment.text[:1000]\n    \nreturn items"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2224,
        -144
      ],
      "id": "36f3292f-ad42-44e8-9f2f-430a11188efe",
      "name": "Trim Long Text"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e47006d6-9adf-46a0-9dc6-54eec6ae2077",
              "name": "username",
              "value": "={{ $json.username }}",
              "type": "string"
            },
            {
              "id": "6bae1a21-7bac-436a-9828-c42b4e402e26",
              "name": "caption",
              "value": "={{ $json.caption }}",
              "type": "string"
            },
            {
              "id": "d44c9bc1-8680-48fe-bb24-f02bfd31137f",
              "name": "likes",
              "value": "={{ $json.likes }}",
              "type": "number"
            },
            {
              "id": "dc26aeff-427f-49d5-8e9a-c333954c65fb",
              "name": "comments_count",
              "value": "={{ $json.comments_count }}",
              "type": "number"
            },
            {
              "id": "c96d0fcc-1ca7-4f74-b6a7-8c97446eb35e",
              "name": "is_sponsorship",
              "value": "={{ $json.is_sponsorship }}",
              "type": "boolean"
            },
            {
              "id": "de7198f2-010b-42ab-914f-f8cabf3db225",
              "name": "coAuthors",
              "value": "={{ $json.coAuthors }}",
              "type": "string"
            },
            {
              "id": "d4329ab0-058d-40ac-ae5f-a19b96ba78fd",
              "name": "tagged_users",
              "value": "={{ $json.tagged_users }}",
              "type": "string"
            },
            {
              "id": "9fcbaa97-fecd-4e98-b1d7-f130827432d0",
              "name": "mentions",
              "value": "={{ $json.mentions }}",
              "type": "string"
            },
            {
              "id": "e55278df-d9c9-4b90-a0ec-ba7fe5899f51",
              "name": "type",
              "value": "={{ $json.type }}",
              "type": "string"
            },
            {
              "id": "cb4961a7-8ac7-4bfb-9b7e-5f887a2b95ba",
              "name": "images",
              "value": "={{ $json.images ? (Array.isArray($json.images) ? $json.images : [$json.images]) : []  }}",
              "type": "array"
            },
            {
              "id": "ad06179b-bad5-4325-ad47-fd386c6b4837",
              "name": "=video_url",
              "value": "={{ $json.video_url || '' }}",
              "type": "string"
            },
            {
              "id": "09350432-1bf4-4087-9a60-b9b9c470800a",
              "name": "comments",
              "value": "={{ $json.comments }}",
              "type": "string"
            },
            {
              "id": "a1a7d244-b20f-4354-83c0-7e84d4697b67",
              "name": "url",
              "value": "={{ $json.url }}",
              "type": "string"
            },
            {
              "id": "70bc7459-9f35-478a-b6d0-44afa04b06e9",
              "name": "id",
              "value": "={{ $json.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1792,
        -144
      ],
      "id": "f35aa96c-6528-42af-8414-736eb70b63ba",
      "name": "Select Fields"
    },
    {
      "parameters": {
        "fieldToSplitOut": "username",
        "include": "allOtherFields",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -3072,
        -144
      ],
      "id": "d3179945-1c5f-45b6-b237-349d437bf4f7",
      "name": "Split Usernames"
    },
    {
      "parameters": {
        "content": "## ðŸ“· Visual Analysis ðŸ‘†\n",
        "height": 80,
        "width": 288,
        "color": 5
      },
      "id": "6fa1c357-a4d9-407c-a7e2-96d1b115a4c4",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1120,
        -160
      ],
      "typeVersion": 1,
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "---\n\n\n## ðŸ”¤ Textual Analysis ðŸ‘‡\n",
        "height": 80,
        "width": 288,
        "color": 5
      },
      "id": "57a829ef-a148-40ca-8c29-2e455ee42431",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1120,
        -80
      ],
      "typeVersion": 1,
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "language": "python",
        "pythonCode": "import json\n\ntry:\n  raw_response = item.json.content.parts[0].text.strip()\n  \n  if raw_response.startswith('{'):\n      return {'textual_analysis': json.loads(raw_response)}\n  \n  trimmed_text = raw_response[raw_response.find('{') : raw_response.rfind('}') + 1]\n  response_json = json.loads(trimmed_text)\n  \n  return {'textual_analysis': response_json}\n\nexcept:\n  return item"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -176,
        64
      ],
      "id": "89cf4f36-7344-486b-90be-0d0dc93525c1",
      "name": "Raw Text -> JSON1"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1u0XML8wegNye1tDqOoYnTY0n1QeXQYTbeArMt1pUYaw",
          "mode": "list",
          "cachedResultName": "IG Analysis",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1u0XML8wegNye1tDqOoYnTY0n1QeXQYTbeArMt1pUYaw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1u0XML8wegNye1tDqOoYnTY0n1QeXQYTbeArMt1pUYaw/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "id",
              "lookupValue": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "0d4b7b0d-b14c-45a5-b79b-f2d3da420828",
      "name": "Search for Existing",
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        -2656,
        -352
      ],
      "typeVersion": 4.5,
      "alwaysOutputData": false,
      "executeOnce": false,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "ajZSh0M8tmSlUQzG",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.0-flash-lite",
          "mode": "list",
          "cachedResultName": "models/gemini-2.0-flash-lite"
        },
        "messages": {
          "values": [
            {
              "content": "=You are an expert Social Media NLP analyst.\nYour goal is to extract meaning, tone, and engagement signals from a postâ€™s caption and comments.\nFocus on language style, audience sentiment, and engagement-driving text features.\n\nTasks:\n\nAnalyze caption and comments together.\n\nClassify tone (emotional, educational, promotional, humorous, authoritative, etc.)\n\nExtract keywords, hashtags, and call-to-action phrases (e.g., â€œlink in bioâ€, â€œtag a friendâ€).\n\nEvaluate audience reaction using comments sentiment and engagement type (supportive, critical, humorous, spammy, etc.).\n\nCompute a textual engagement potential score (0â€“100).\nTasks:\n- Sentiment & tone classification (e.g. emotional, educational, promotional)\n- Hashtag clustering & frequency analysis\n- Keyword extraction (â€œproduct namesâ€, â€œeventsâ€, â€œemotionsâ€, â€œhooksâ€)\n- Detect â€œCTA presenceâ€ (â€œlink in bioâ€, â€œtag a friendâ€, etc.)\n\nOutput JSON Schema:\n{\n  \"caption_summary\": \"Concise one-line summary of the post caption.\",\n  \"caption_tone\": \"e.g. emotional, educational, promotional, humorous\",\n  \"sentiment_score\": 0.0-1.0,\n  \"keywords\": [\"list of relevant nouns or phrases\"],\n  \"hashtags\": [\"#tag1\", \"#tag2\", \"#tag3\"],\n  \"cta_present\": true | false,\n  \"comments_summary\": \"Summarized sentiment or themes of top comments.\",\n  \"comments_sentiment_score\": 0.0-1.0,\n  \"audience_reaction_type\": \"supportive | mixed | critical | playful | neutral\",\n  \"textual_engagement_score\": 0-100\n}\n\n\nTarget Caption:\n{{ $json.caption }}\n\nTarget Comments:\n{{ $json.comments }}"
            }
          ]
        },
        "jsonOutput": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -800,
        64
      ],
      "id": "a32ff804-c58a-4e81-b19a-dd033f2cefdf",
      "name": "Analyze Caption",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "alwaysOutputData": false,
      "credentials": {
        "googlePalmApi": {
          "id": "XTXNQOHi2Z3XaNkC",
          "name": "n8n-HF Gemini API"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "resource": "video",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "text": "You are an expert in Social-Media Performance Analysis and Computer Vision.\nYour job is to analyze the provided Instagram post media (image, video, or carousel) from a marketing performance perspective.\nYou must detect what visually appears, how it is styled, and which elements likely drive engagement.\nOutput only a single valid JSON object strictly following the schema below.\nDo not include any prose, commentary, or code fences â€” only JSON.\n\nJSON Output Schema (return exactly this structure)\n\n{\n  \"media_type\": \"image | video | album\",\n  \"summary\": \"Concise overall description of whatâ€™s visually shown.\",\n  \"theme\": \"main idea or concept (e.g. family, luxury, humor, fitness)\",\n  \"subjects\": [\"short list of main people or items\"],\n  \"setting\": \"brief scene context (e.g. outdoor daylight, studio, home interior)\",\n  \"style\": {\n    \"shot\": \"close-up | mid-shot | wide | selfie | etc.\",\n    \"vibe\": \"casual | cinematic | professional | playful | luxury\",\n    \"color\": \"warm vibrant | pastel muted | monochrome blue | etc.\",\n    \"lighting\": \"natural daylight | studio | low light | backlit | etc.\"\n  },\n  \"visual_hooks\": [\"For video:what appears in the first few seconds that grabs attention. For image: the most visually prominent element.\"],\n  \"emotional_tone\": \"aspirational | fun | relatable | educational | etc.\",\n  \"hook_moment\": \"for videos: main opening hook (optional)\",\n  \"engagement_score\": 0-100,\n  \"why_it_works\": \"short explanation of why the visual likely performs well\"\n}\n\nFINAL OUTPUT INSTRUCTION (CRITICAL):\n\nYou must output a single, valid JSON object.\nDO NOT include the surrounding markdown fence (e.g., ```json or ```).\nDO NOT include any leading or trailing whitespace or newlines.\nThe output MUST begin with the character { and end with the character }.",
        "videoUrls": "={{ $json.video_url }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -672,
        -128
      ],
      "id": "c75a1706-3ef3-439f-ae23-9aff9365fd6b",
      "name": "Analyze Video",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "credentials": {
        "googlePalmApi": {
          "id": "XTXNQOHi2Z3XaNkC",
          "name": "n8n-HF Gemini API"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "maxItems": 2
      },
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        -912,
        -640
      ],
      "id": "99248e75-c45c-4775-be59-6181a467f0b5",
      "name": "Limit Image per Post"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1u0XML8wegNye1tDqOoYnTY0n1QeXQYTbeArMt1pUYaw",
          "mode": "list",
          "cachedResultName": "IG Analysis",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1u0XML8wegNye1tDqOoYnTY0n1QeXQYTbeArMt1pUYaw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1u0XML8wegNye1tDqOoYnTY0n1QeXQYTbeArMt1pUYaw/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Select Fields').item.json.id }}",
            "textual_analysis": "={{ $json.textual_analysis }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "shortCode",
              "displayName": "shortCode",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "caption",
              "displayName": "caption",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "likes",
              "displayName": "likes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "comments_count",
              "displayName": "comments_count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "display_image",
              "displayName": "display_image",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "acc_caption",
              "displayName": "acc_caption",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "is_sponsorship",
              "displayName": "is_sponsorship",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "username",
              "displayName": "username",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "coAuthors",
              "displayName": "coAuthors",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mentions",
              "displayName": "mentions",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "tagged_users",
              "displayName": "tagged_users",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "type",
              "displayName": "type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "images",
              "displayName": "images",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "video_url",
              "displayName": "video_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "comments",
              "displayName": "comments",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "gif_comments",
              "displayName": "gif_comments",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "visual_analysis",
              "displayName": "visual_analysis",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "textual_analysis",
              "displayName": "textual_analysis",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "cellFormat": "RAW"
        }
      },
      "id": "136a9109-9642-4006-85e6-69994c396170",
      "name": "Save Text Analysis",
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        304,
        64
      ],
      "typeVersion": 4.5,
      "alwaysOutputData": false,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "ajZSh0M8tmSlUQzG",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "language": "python",
        "pythonCode": "import json\n\ntry:\n  \n  raw_response = item.json.content.parts[0].text.strip()\n  \n  if raw_response.startswith('{'):\n      return json.loads(raw_response)\n  \n  trimmed_text = raw_response[raw_response.find('{') : raw_response.rfind('}') + 1]\n  response_json = json.loads(trimmed_text)\n  \n  return response_json\n\nexcept:\n  return item"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -176,
        -640
      ],
      "id": "9af4e5e0-1347-43b8-8836-a28520038247",
      "name": "Raw Text -> JSON",
      "retryOnFail": false,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "language": "python",
        "pythonCode": "import json\n\ntry:\n  \n  raw_response = item.json.content.parts[0].text.strip()\n  \n  if raw_response.startswith('{'):\n      return json.loads(raw_response)\n  \n  trimmed_text = raw_response[raw_response.find('{') : raw_response.rfind('}') + 1]\n  response_json = json.loads(trimmed_text)\n  \n  return response_json\n\nexcept:\n  return item"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -176,
        -128
      ],
      "id": "a7290d23-6cd2-4cc7-9762-4ab53bcf11b7",
      "name": "Raw Text -> JSON2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4f39f91c-2117-4d74-a2e1-7c0b32183bd5",
              "name": "caption",
              "value": "={{ $json.caption || '' }}",
              "type": "string"
            },
            {
              "id": "a2bdbf56-828c-4862-b53b-b559098d9189",
              "name": "comments",
              "value": "={{ $json.comments }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1296,
        64
      ],
      "id": "86e4b8fd-9a00-43c4-8132-354114d9d993",
      "name": "Extract caption & comments"
    },
    {
      "parameters": {
        "content": "## â” Safe Output\n\nNot all models follow output instructions in prompts concisely.\nThis code handles if the response is in markdown or other formats to export correct JSON.\n",
        "height": 176,
        "width": 272,
        "color": 4
      },
      "id": "ef97697a-cc76-4f30-a320-f8688e0d4e4d",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -224,
        192
      ],
      "typeVersion": 1,
      "name": "Sticky Note6",
      "disabled": true
    },
    {
      "parameters": {
        "content": "## ðŸ“ˆ STEP 4: AI Insights & Recommendations\n\nThe Final **Strategy Specialist AI** Gives insights:\n\n1. **Fetch Posts Metrics** Get each posts data e.g.: likes, comment_count, URL, tagged_users, mentions, etc...\n2. **Merge Items**: Merge analytics into a single list to pass to final AI.\n3. **Find Insights** Extract valuable insights aboutposts (most engaged content, best media type (reels, images), viral hashtags, etc...), and what didn't work too (least engaged, why it didn't work, etc..)\n4. **Suggest a Strategy** Suggest recommendations to experiment based on analyzed content.",
        "height": 296,
        "width": 624
      },
      "id": "cd222681-718f-4ea0-a593-520b14177496",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1280,
        -480
      ],
      "typeVersion": 1,
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        1776,
        -128
      ],
      "id": "5cae9aa2-cdd2-4ab9-b029-024732f36bff",
      "name": "Aggregate all Posts"
    },
    {
      "parameters": {
        "mode": "combine",
        "fieldsToMatchString": "id",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1056,
        -128
      ],
      "id": "e14a4c54-5b4a-4ddc-bac2-00c310bd04d0",
      "name": "Merge Each Post Analysis Media + Text"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "messages": {
          "values": [
            {
              "content": "={{ JSON.stringify($json.data) }}"
            }
          ]
        },
        "jsonOutput": true,
        "options": {
          "systemMessage": "You are a senior social media intelligence analyst.\nYou receive structured analyses of multiple posts (visual & textual) and metrics and their metrics.\nYour goal is to extract *strategic*, *data-backed* insights about content performance, patterns, and future opportunities.\n\nTasks\n1. Identify patterns and contrasts:\nFind common traits among high-performing vs low-performing posts.\nDetermine what differentiates them in tone, theme, and style.\n2. Summarize content performance dimensions:\nEmotional tone, visual style, caption sentiment, hashtags, and CTAs.\n3. Quantify trends:\nCalculate engagement averages and frequency of recurring attributes.\n4. Highlight strategic learnings:\nWhat to amplify, adjust, or avoid in future posts.\n5. Generate a compact, human-readable strategy summary.\n\nFINAL OUTPUT (CRITICAL):\n\nYou must output a single, valid JSON object.\nDO NOT include the surrounding markdown fence (e.g., ```json or ```).\nDO NOT include any leading or trailing whitespace or newlines.\nThe output MUST begin with the character { and end with the character }.\n\nExample Output:\n{\n  \"overview\": {\n    \"total_posts_analyzed\": 54,\n    \"average_engagement\": 68.4,\n    \"median_engagement\": 71,\n    \"overall_sentiment\": \"positive\",\n    \"dominant_media_type\": \"video\",\n    \"engagement_trend\": \"rising in last 10 posts\"\n  },\n  \"top_performing_patterns\": {\n    \"themes\": [\"authentic lifestyle\", \"motivation\", \"family moments\"],\n    \"tones\": [\"relatable\", \"educational\", \"inspirational\"],\n    \"visual_styles\": [\"natural daylight\", \"mid-shot\", \"warm color palette\"],\n    \"caption_features\": [\"concise + emotional\", \"includes soft CTA\", \"high emoji density\"],\n    \"hashtag_traits\": [\"specific niche hashtags\", \"mix of broad + micro\"],\n    \"engagement_score_avg\": 89.2,\n    \"sample_high_posts\": [\"post_23_url\", \"post_42_url\"]\n  },\n  \"low_performing_patterns\": {\n    \"themes\": [\"generic promotional\", \"static product shots\"],\n    \"tones\": [\"neutral\", \"corporate\", \"informational\"],\n    \"visual_styles\": [\"flat lighting\", \"monochrome muted\"],\n    \"caption_features\": [\"overly long\", \"no CTA\", \"excessive hashtags\"],\n    \"engagement_score_avg\": 42.8,\n    \"sample_low_posts\": [\"post_7_url\", ...]\n  },\n  \"engagement_drivers\": [\n    \"Emotional authenticity and human presence in visuals\",\n    \"Movement or expressive hooks in first seconds of videos\",\n    \"Concise captions ending with a relatable hook or question\"\n  ],\n  \"engagement_barriers\": [\n    \"Over-edited visuals or staged product photos\",\n    \"Lack of clear subject or story in visuals\",\n    \"Captions without emotional tone or CTA\"\n  ],\n  \"audience_behavior\": {\n    \"prefers_media\": \"short videos (â‰¤30s)\",\n    \"responds_best_to_tone\": \"personal, inspirational, humorous\",\n    \"engagement_peak_days\": [\"Wednesday\", \"Sunday\"],\n    \"preferred_caption_length\": \"under 100 characters\",\n    \"hashtag_effectiveness\": {\n      \"optimal_count\": 5,\n      \"low_engagement_when\": \"more than 10 hashtags\"\n    }\n  },\n  \"content_opportunities\": [\n    \"Leverage trending micro-hashtags around current events\",\n    \"Increase behind-the-scenes content with authentic tone\",\n    \"Experiment with interactive captions (polls, questions)\"\n  ],\n  \"visual_trends_summary\": {\n    \"frequent_styles\": [\"close-up\", \"warm daylight\", \"outdoor\"],\n    \"underused_but_potential\": [\"cinematic low-light mood\", \"color-graded storytelling\"],\n    \"hook_characteristics\": [\"facial expression\", \"motion\", \"eye contact\"]\n  },\n  \"textual_trends_summary\": {\n    \"most_common_keywords\": [\"family\", \"growth\", \"journey\", \"community\"],\n    \"dominant_tones\": [\"personal\", \"motivational\"],\n    \"cta_presence_rate\": \"27%\",\n    \"effective_caption_patterns\": [\"1-line story + emoji\", \"short hook + CTA\"]\n  },\n  \"recommendations\": [\n    \"Use consistent CTA placement â€” preferably at the end of captions.\",\n    \"Limit hashtags to 4â€“6 highly relevant ones.\",\n    \"Avoid generic product-only visuals unless combined with human interaction.\",\n    \"Maintain 70% video, 30% image ratio for best engagement.\"\n  ],\n  \"strategy_summary\": \"High-performing content consistently blends warmth, relatability, and concise emotional messaging. Videos with expressive motion or human connection outperform static posts. Future strategy should prioritize authenticity, soft storytelling, and balanced use of hashtags and CTAs.\"\n}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        2016,
        -128
      ],
      "id": "39fd983c-692f-4ff0-890e-59d873ab2483",
      "name": "Strategy Specialist1",
      "credentials": {
        "googlePalmApi": {
          "id": "XTXNQOHi2Z3XaNkC",
          "name": "n8n-HF Gemini API"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1u0XML8wegNye1tDqOoYnTY0n1QeXQYTbeArMt1pUYaw",
          "mode": "list",
          "cachedResultName": "IG Analysis",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1u0XML8wegNye1tDqOoYnTY0n1QeXQYTbeArMt1pUYaw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1u0XML8wegNye1tDqOoYnTY0n1QeXQYTbeArMt1pUYaw/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "id",
              "lookupValue": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1280,
        -128
      ],
      "id": "208487a5-d817-4b54-9960-955d04a5544c",
      "name": "Get Other Post Data",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "ajZSh0M8tmSlUQzG",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c3152cc2-394d-473f-b2c4-7196bf7f0111",
              "name": "created_at",
              "value": "={{ $json.created_at }}",
              "type": "string"
            },
            {
              "id": "933d50e3-31f2-4234-b5bf-ec5a593cfb36",
              "name": "url",
              "value": "={{ $json.url }}",
              "type": "string"
            },
            {
              "id": "56ed7ccb-9129-4d00-a3b1-db62870aad39",
              "name": "likes",
              "value": "={{ $json.likes }}",
              "type": "number"
            },
            {
              "id": "34c663ea-11f9-4d6d-85ce-e5cd1e52371c",
              "name": "comments_count",
              "value": "={{ $json.comments_count }}",
              "type": "number"
            },
            {
              "id": "3388595d-de5e-4163-bbd4-dae061db793e",
              "name": "is_sponsorship",
              "value": "={{ $json.is_sponsorship }}",
              "type": "boolean"
            },
            {
              "id": "0d8029e0-6d05-4df3-89a8-b873c67e558d",
              "name": "username",
              "value": "={{ $json.username }}",
              "type": "string"
            },
            {
              "id": "44956901-e790-47fb-a295-af5030777439",
              "name": "coAuthors",
              "value": "={{ $json.coAuthors }}",
              "type": "string"
            },
            {
              "id": "72fb0259-1c5f-48f0-a3ca-67f2495f3bd8",
              "name": "mentions",
              "value": "={{ $json.mentions }}",
              "type": "string"
            },
            {
              "id": "dc226fee-6435-4ee8-982a-beb8123f7b42",
              "name": "tagged_users",
              "value": "={{ $json.tagged_users }}",
              "type": "string"
            },
            {
              "id": "69888b8f-f8a5-43e9-9ee5-50de7de257b4",
              "name": "type",
              "value": "={{ $json.type }}",
              "type": "string"
            },
            {
              "id": "d3a944b6-c0db-4523-ae6c-e3099f560b29",
              "name": "visual_analysis",
              "value": "={{ $json.visual_analysis }}",
              "type": "string"
            },
            {
              "id": "da0b2d59-e731-4844-a9c4-6f307037f48d",
              "name": "textual_analysis",
              "value": "={{ $json.textual_analysis }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1536,
        -128
      ],
      "id": "a0d158a5-7b04-4658-b313-912938ab8deb",
      "name": "Filter fields"
    },
    {
      "parameters": {
        "amount": 10
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -432,
        -640
      ],
      "id": "20c5c6ff-972f-4694-9f62-00003026d4fa",
      "name": "Delay Between Calls",
      "webhookId": "b61014a9-9dea-4c3b-8214-62c13ac10c52"
    },
    {
      "parameters": {
        "content": "## â” API Rate Limit (Optional)\n\nBe careful not to hit your AI provider rate limit (Gemini in this case).\nIf it's not an issue & you don't want any delay, deactivate the wait nodes.",
        "height": 176,
        "width": 336,
        "color": 4
      },
      "id": "f606ba32-3b6d-4f94-8cc0-54b34441eed3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -544,
        -832
      ],
      "typeVersion": 1,
      "name": "Sticky Note8",
      "disabled": true
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "language": "python",
        "pythonCode": "import json\n\ntry:\n  \n  raw_response = item.json.content.parts[0].text.strip()\n  \n  if raw_response.startswith('{'):\n      return json.loads(raw_response)\n  \n  trimmed_text = raw_response[raw_response.find('{') : raw_response.rfind('}') + 1]\n  response_json = json.loads(trimmed_text)\n  \n  return response_json\n\nexcept:\n  return item"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -176,
        -320
      ],
      "id": "2694a89d-014b-45ab-9489-4369443e7a4d",
      "name": "Raw Text -> JSON3",
      "retryOnFail": false
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -1360,
        -432
      ],
      "id": "39a4ad99-03d5-4803-b710-75f43f6ba248",
      "name": "Loop over Albums"
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.0-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.0-flash"
        },
        "text": "You are an expert in Social-Media Performance Analysis and Computer Vision.\nYour job is to analyze the provided Instagram post media (image, video, or carousel) from a marketing performance perspective.\nYou must detect what visually appears, how it is styled, and which elements likely drive engagement.\nOutput only a single valid JSON object strictly following the schema below.\nDo not include any prose, commentary, or code fences â€” only JSON.\n\nJSON Output Schema (return exactly this structure)\n\n{\n  \"media_type\": \"image | video | album\",\n  \"summary\": \"Concise overall description of whatâ€™s visually shown.\",\n  \"theme\": \"main idea or concept (e.g. family, luxury, humor, fitness)\",\n  \"subjects\": [\"short list of main people or items\"],\n  \"setting\": \"brief scene context (e.g. outdoor daylight, studio, home interior)\",\n  \"style\": {\n    \"shot\": \"close-up | mid-shot | wide | selfie | etc.\",\n    \"vibe\": \"casual | cinematic | professional | playful | luxury\",\n    \"color\": \"warm vibrant | pastel muted | monochrome blue | etc.\",\n    \"lighting\": \"natural daylight | studio | low light | backlit | etc.\"\n  },\n  \"visual_hooks\": [\"For video:what appears in the first few seconds that grabs attention. For image: the most visually prominent element.\"],\n  \"emotional_tone\": \"aspirational | fun | relatable | educational | etc.\",\n  \"hook_moment\": \"for videos: main opening hook (optional)\",\n  \"engagement_score\": 0-100,\n  \"why_it_works\": \"short explanation of why the visual likely performs well\"\n}\n\nFINAL OUTPUT INSTRUCTION (CRITICAL):\n\nYou must output a single, valid JSON object.\nDO NOT include the surrounding markdown fence (e.g., ```json or ```).\nDO NOT include any leading or trailing whitespace or newlines.\nThe output MUST begin with the character { and end with the character }.",
        "imageUrls": "={{ $json.images }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -672,
        -640
      ],
      "id": "1e84fa78-a729-452f-abab-17a07383dac4",
      "name": "Analyze Album",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "credentials": {
        "googlePalmApi": {
          "id": "XTXNQOHi2Z3XaNkC",
          "name": "n8n-HF Gemini API"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "text": "You are an expert in Social-Media Performance Analysis and Computer Vision.\nYour job is to analyze the provided Instagram post media (image, video, or carousel) from a marketing performance perspective.\nYou must detect what visually appears, how it is styled, and which elements likely drive engagement.\nOutput only a single valid JSON object strictly following the schema below.\nDo not include any prose, commentary, or code fences â€” only JSON.\n\nJSON Output Schema (return exactly this structure)\n\n{\n  \"media_type\": \"image | video | album\",\n  \"summary\": \"Concise overall description of whatâ€™s visually shown.\",\n  \"theme\": \"main idea or concept (e.g. family, luxury, humor, fitness)\",\n  \"subjects\": [\"short list of main people or items\"],\n  \"setting\": \"brief scene context (e.g. outdoor daylight, studio, home interior)\",\n  \"style\": {\n    \"shot\": \"close-up | mid-shot | wide | selfie | etc.\",\n    \"vibe\": \"casual | cinematic | professional | playful | luxury\",\n    \"color\": \"warm vibrant | pastel muted | monochrome blue | etc.\",\n    \"lighting\": \"natural daylight | studio | low light | backlit | etc.\"\n  },\n  \"visual_hooks\": [\"For video:what appears in the first few seconds that grabs attention. For image: the most visually prominent element.\"],\n  \"emotional_tone\": \"aspirational | fun | relatable | educational | etc.\",\n  \"hook_moment\": \"for videos: main opening hook (optional)\",\n  \"engagement_score\": 0-100,\n  \"why_it_works\": \"short explanation of why the visual likely performs well\"\n}\n\nFINAL OUTPUT INSTRUCTION (CRITICAL):\n\nYou must output a single, valid JSON object.\nDO NOT include the surrounding markdown fence (e.g., ```json or ```).\nDO NOT include any leading or trailing whitespace or newlines.\nThe output MUST begin with the character { and end with the character }.",
        "imageUrls": "={{ $json.images[0] }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -672,
        -320
      ],
      "id": "01c5b786-29ad-4c97-9ee9-cab8daae2ac0",
      "name": "Analyze Image",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "credentials": {
        "googlePalmApi": {
          "id": "XTXNQOHi2Z3XaNkC",
          "name": "n8n-HF Gemini API"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "visual_analysis",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        80,
        -640
      ],
      "id": "b650a8ab-b7e0-49a5-89c5-8d3dec3b88be",
      "name": "Group Single Album Images"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.type }}",
                    "rightValue": "Album",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "f343f61e-32ac-4945-a9ce-e0299a37160b"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "736fc036-f61d-46d7-ab9b-332413c5f89e",
                    "leftValue": "={{ $json.type }}",
                    "rightValue": "Photo",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "6aa44cd8-bd17-4ccb-bbbb-c850f698daba",
                    "leftValue": "={{ $json.type }}",
                    "rightValue": "Reel",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "10db7443-aad4-41dd-8c83-374226e3216c",
                    "leftValue": "1",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "allMatchingOutputs": true
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -1584,
        -176
      ],
      "id": "a1f7abcc-7e50-4775-be4b-da15a6fa3047",
      "name": "Route Media Type"
    },
    {
      "parameters": {
        "fieldToSplitOut": "images",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -1152,
        -640
      ],
      "id": "1c8ca7a8-2ebb-40d8-bae9-149a6fa1cf37",
      "name": "Split Album Images"
    },
    {
      "parameters": {
        "numberInputs": 3
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        752,
        -432
      ],
      "id": "806df86b-6ff8-4464-9232-ad90b9b58848",
      "name": "Append Visual Analysis"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1u0XML8wegNye1tDqOoYnTY0n1QeXQYTbeArMt1pUYaw",
          "mode": "list",
          "cachedResultName": "IG Analysis",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1u0XML8wegNye1tDqOoYnTY0n1QeXQYTbeArMt1pUYaw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1u0XML8wegNye1tDqOoYnTY0n1QeXQYTbeArMt1pUYaw/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Select Fields').item.json.id }}",
            "visual_analysis": "={{ [$json] }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "shortCode",
              "displayName": "shortCode",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "caption",
              "displayName": "caption",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "likes",
              "displayName": "likes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "comments_count",
              "displayName": "comments_count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "display_image",
              "displayName": "display_image",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "acc_caption",
              "displayName": "acc_caption",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "is_sponsorship",
              "displayName": "is_sponsorship",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "username",
              "displayName": "username",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "coAuthors",
              "displayName": "coAuthors",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mentions",
              "displayName": "mentions",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "tagged_users",
              "displayName": "tagged_users",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "type",
              "displayName": "type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "images",
              "displayName": "images",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "video_url",
              "displayName": "video_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "comments",
              "displayName": "comments",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "gif_comments",
              "displayName": "gif_comments",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "visual_analysis",
              "displayName": "visual_analysis",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "textual_analysis",
              "displayName": "textual_analysis",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "cellFormat": "RAW"
        }
      },
      "id": "47df8159-dce4-4189-ad2a-d2f070367005",
      "name": "Save Video Analysis",
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        304,
        -128
      ],
      "typeVersion": 4.5,
      "alwaysOutputData": false,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "ajZSh0M8tmSlUQzG",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1u0XML8wegNye1tDqOoYnTY0n1QeXQYTbeArMt1pUYaw",
          "mode": "list",
          "cachedResultName": "IG Analysis",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1u0XML8wegNye1tDqOoYnTY0n1QeXQYTbeArMt1pUYaw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1u0XML8wegNye1tDqOoYnTY0n1QeXQYTbeArMt1pUYaw/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Select Fields').item.json.id }}",
            "visual_analysis": "={{ [$json] }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "shortCode",
              "displayName": "shortCode",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "caption",
              "displayName": "caption",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "likes",
              "displayName": "likes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "comments_count",
              "displayName": "comments_count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "display_image",
              "displayName": "display_image",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "acc_caption",
              "displayName": "acc_caption",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "is_sponsorship",
              "displayName": "is_sponsorship",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "username",
              "displayName": "username",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "coAuthors",
              "displayName": "coAuthors",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mentions",
              "displayName": "mentions",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "tagged_users",
              "displayName": "tagged_users",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "type",
              "displayName": "type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "images",
              "displayName": "images",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "video_url",
              "displayName": "video_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "comments",
              "displayName": "comments",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "gif_comments",
              "displayName": "gif_comments",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "visual_analysis",
              "displayName": "visual_analysis",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "textual_analysis",
              "displayName": "textual_analysis",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "cellFormat": "RAW"
        }
      },
      "id": "6211087b-3e27-44e4-9c7a-8ba31179829b",
      "name": "Save Photo Analysis",
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        304,
        -320
      ],
      "typeVersion": 4.5,
      "alwaysOutputData": false,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "ajZSh0M8tmSlUQzG",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1u0XML8wegNye1tDqOoYnTY0n1QeXQYTbeArMt1pUYaw",
          "mode": "list",
          "cachedResultName": "IG Analysis",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1u0XML8wegNye1tDqOoYnTY0n1QeXQYTbeArMt1pUYaw/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1u0XML8wegNye1tDqOoYnTY0n1QeXQYTbeArMt1pUYaw/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Select Fields').item.json.id }}",
            "visual_analysis": "={{ $json.visual_analysis }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "shortCode",
              "displayName": "shortCode",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "caption",
              "displayName": "caption",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "likes",
              "displayName": "likes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "comments_count",
              "displayName": "comments_count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "display_image",
              "displayName": "display_image",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "acc_caption",
              "displayName": "acc_caption",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "is_sponsorship",
              "displayName": "is_sponsorship",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "username",
              "displayName": "username",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "coAuthors",
              "displayName": "coAuthors",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "mentions",
              "displayName": "mentions",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "tagged_users",
              "displayName": "tagged_users",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "type",
              "displayName": "type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "images",
              "displayName": "images",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "video_url",
              "displayName": "video_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "comments",
              "displayName": "comments",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "gif_comments",
              "displayName": "gif_comments",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "visual_analysis",
              "displayName": "visual_analysis",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "textual_analysis",
              "displayName": "textual_analysis",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "cellFormat": "RAW"
        }
      },
      "id": "ab2ddf0f-695d-4fac-94ab-bf425e506137",
      "name": "Save Album Analysis",
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        304,
        -640
      ],
      "typeVersion": 4.5,
      "alwaysOutputData": false,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "ajZSh0M8tmSlUQzG",
          "name": "Google Sheets account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Split Usernames",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Drop Duplicates": {
      "main": [
        [
          {
            "node": "Trim Long Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Run IG Scraper & Get dataset": {
      "main": [
        [
          {
            "node": "Drop Duplicates",
            "type": "main",
            "index": 1
          },
          {
            "node": "Search for Existing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Posts": {
      "main": [
        [
          {
            "node": "Select Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Trim Long Text": {
      "main": [
        [
          {
            "node": "Save Posts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select Fields": {
      "main": [
        [
          {
            "node": "Route Media Type",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Usernames": {
      "main": [
        [
          {
            "node": "Run IG Scraper & Get dataset",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Raw Text -> JSON1": {
      "main": [
        [
          {
            "node": "Save Text Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search for Existing": {
      "main": [
        [
          {
            "node": "Drop Duplicates",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze Caption": {
      "main": [
        [
          {
            "node": "Raw Text -> JSON1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze Video": {
      "main": [
        [
          {
            "node": "Raw Text -> JSON2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit Image per Post": {
      "main": [
        [
          {
            "node": "Analyze Album",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Text Analysis": {
      "main": [
        [
          {
            "node": "Merge Each Post Analysis Media + Text",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Raw Text -> JSON": {
      "main": [
        [
          {
            "node": "Group Single Album Images",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Raw Text -> JSON2": {
      "main": [
        [
          {
            "node": "Save Video Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract caption & comments": {
      "main": [
        [
          {
            "node": "Analyze Caption",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate all Posts": {
      "main": [
        [
          {
            "node": "Strategy Specialist1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Each Post Analysis Media + Text": {
      "main": [
        [
          {
            "node": "Get Other Post Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Strategy Specialist1": {
      "main": [
        []
      ]
    },
    "Get Other Post Data": {
      "main": [
        [
          {
            "node": "Filter fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter fields": {
      "main": [
        [
          {
            "node": "Aggregate all Posts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delay Between Calls": {
      "main": [
        [
          {
            "node": "Raw Text -> JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Raw Text -> JSON3": {
      "main": [
        [
          {
            "node": "Save Photo Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop over Albums": {
      "main": [
        [
          {
            "node": "Append Visual Analysis",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Split Album Images",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze Album": {
      "main": [
        [
          {
            "node": "Delay Between Calls",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze Image": {
      "main": [
        [
          {
            "node": "Raw Text -> JSON3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Group Single Album Images": {
      "main": [
        [
          {
            "node": "Save Album Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route Media Type": {
      "main": [
        [
          {
            "node": "Loop over Albums",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Analyze Image",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Analyze Video",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract caption & comments",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Album Images": {
      "main": [
        [
          {
            "node": "Limit Image per Post",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append Visual Analysis": {
      "main": [
        [
          {
            "node": "Merge Each Post Analysis Media + Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Video Analysis": {
      "main": [
        [
          {
            "node": "Append Visual Analysis",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Save Photo Analysis": {
      "main": [
        [
          {
            "node": "Append Visual Analysis",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Save Album Analysis": {
      "main": [
        [
          {
            "node": "Loop over Albums",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "cc1665a0-209a-44b0-97e4-be7caaef5efe",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "a5f908741ae8d3a40d6024f6d5973bbde6f528e9344c887836ffd50f7aeca584"
  },
  "id": "KysdWpjtjMFpboja",
  "tags": []
}